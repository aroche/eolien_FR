<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8" />
<meta name="author" content="Augustin Roche" />
<title>L'éolien en France</title>
<style>
body {
    font-family: helvetica;
}

.region { 
    stroke: black;
    stroke-width: 1;

}

svg {
    margin-left: 100px;
}

path.domain, .tick.major line {
    fill: none;
    stroke: black;
} 

#annees .tick, #legende_couleurs text {
    font-size: 75%;
}

.graphBar {
    fill: #005A32;
}
.graphBar:hover {
    opacity: 0.75;
}
.graphBar.selected {
    stroke: #ffd42a;
    stroke-width: 3;
    opacity: 0.75;
}
.controlButton {
   fill: #333333;
}

.tooltip {
    background-color: #c2e699;
    border: 2px solid #005a32;
    position: absolute;
    z-index: 10;
    padding: 2px;
}

#legende {
    font-size: 16px;
    font-weight: bold;
}

#play_anim rect {
    fill: #c2e699;
    stroke: #005a32;
    stroke-width: 2;    
}
#play_anim text {
    font-weight: bold;
    text-anchor: middle;
    text-align: center;
}
</style>
<script src="lib/d3.v3.min.js"></script>
<script src="lib/topojson.v0.min.js"></script>
<script src="lib/cartogram.min.js"></script>
</head>
<body>
<h1>Puissance éolienne installée en France</h1>

<!-- Version avec données intégrées -->
<script>
// Based on the example http://prag.ma/code/d3-cartogram/ (Author: Shawn Allen)

// Configuration des éléments
/*
var conf = {
  map: {
    position: {x:, y:},
    // couleurs corresondant aux valeurs min et max de puissance
    from_color: ,
    to_color: ,
    border_color:
  },
  gradient_caption: {
    position: {x: , y: }
  },
  histogram: {
    position: {x:, y: },
    bar_color: 
  },
  animation_button: {
    position: {x:, y:},
    backgroud_color: ,
    border_color:
  }
};
*/

// Données à mettre à jour
var data = [
	{ "nom_reg": "Alsace",  "2000": 0, "2001": 0, "2002": 0, "2003": 0, "2004": 0, "2005": 0, "2006": 0, "2007": 0, "2008": 0, "2009": 0, "2010": 0, "2011": 0, "2012": 0, "2013": 12, "2014":12, "2015":12, "code_reg": 42 },
	{ "nom_reg": "Aquitaine",   "2000": 0, "2001": 0, "2002": 0, "2003": 0, "2004": 0, "2005": 0, "2006": 0, "2007": 0, "2008": 0, "2009": 0, "2010": 0, "2011": 0, "2012": 0, "2013": 0, "2014":0, "2015":12, "code_reg": 72 },
	{ "nom_reg": "Auvergne",    "2000": 0, "2001": 0, "2002": 0, "2003": 0, "2004": 0, "2005": 39, "2006": 55, "2007": 55, "2008": 101, "2009": 125, "2010": 151, "2011": 165, "2012": 188, "2013": 188, "2014": 201, "2015":222, "code_reg": 83 },
	{ "nom_reg": "Basse-Normandie", "2000": 0, "2001": 0, "2002": 0, "2003": 0, "2004": 10, "2005": 27, "2006": 51, "2007": 51, "2008": 96, "2009": 155, "2010": 201, "2011": 215, "2012": 227, "2013": 227, "2014":263, "2015":268, "code_reg": 25 },
	{ "nom_reg": "Bourgogne",   "2000": 0, "2001": 0, "2002": 0, "2003": 0, "2004": 0, "2005": 0, "2006": 0, "2007": 0, "2008": 50, "2009": 50, "2010": 62, "2011": 92, "2012": 138, "2013": 150, "2014":261, "2015":279, "code_reg": 26 },
	{ "nom_reg": "Bretagne",    "2000": 9, "2001": 9, "2002": 14, "2003": 20, "2004": 41, "2005": 134, "2006": 218, "2007": 286, "2008": 379, "2009": 481, "2010": 651, "2011": 678, "2012": 748, "2013": 782, "2014":826, "2015":836, "code_reg": 53 },
	{ "nom_reg": "Centre",  "2000": 0, "2001": 0, "2002": 0, "2003": 0, "2004": 0, "2005": 23, "2006": 293, "2007": 327, "2008": 392, "2009": 502, "2010": 588, "2011": 672, "2012": 686, "2013": 758, "2014":791, "2015":870, "code_reg": 24 },
	{ "nom_reg": "Champagne-Ardenne",   "2000": 0, "2001": 0, "2002": 0, "2003": 2, "2004": 10, "2005": 58, "2006": 111, "2007": 149, "2008": 259, "2009": 425, "2010": 847, "2011": 980, "2012": 1138, "2013": 1284, "2014":1527, "2015":1571, "code_reg": 21 },
	{ "nom_reg": "Franche-Comté",   "2000": 0, "2001": 0, "2002": 0, "2003": 0, "2004": 0, "2005": 0, "2006": 0, "2007": 30, "2008": 30, "2009": 30, "2010": 30, "2011": 30, "2012": 30, "2013": 30, "2014":30, "2015":30, "code_reg": 43 },
	{ "nom_reg": "Haute-Normandie", "2000": 0, "2001": 0, "2002": 0, "2003": 0, "2004": 0, "2005": 11, "2006": 16, "2007": 82, "2008": 94, "2009": 126, "2010": 166, "2011": 217, "2012": 228, "2013": 249, "2014":256, "2015":270, "code_reg": 23 },
	{ "nom_reg": "Île-de-France",   "2000": 0, "2001": 0, "2002": 0, "2003": 0, "2004": 0, "2005": 0, "2006": 0, "2007": 0, "2008": 0, "2009": 0, "2010": 0, "2011": 19, "2012": 19, "2013": 19, "2014":19, "2015":19, "code_reg": 11 },
	{ "nom_reg": "Languedoc-Roussillon",    "2000": 10, "2001": 20, "2002": 61, "2003": 85, "2004": 97, "2005": 141, "2006": 245, "2007": 266, "2008": 356, "2009": 387, "2010": 427, "2011": 439, "2012": 478, "2013": 479, "2014":532, "2015":532, "code_reg": 91 },
	{ "nom_reg": "Limousin",    "2000": 0, "2001": 0, "2002": 0, "2003": 0, "2004": 9, "2005": 9, "2006": 9, "2007": 9, "2008": 9, "2009": 9, "2010": 9, "2011": 21, "2012": 33, "2013": 45, "2014":48, "2015":48, "code_reg": 74 },
	{ "nom_reg": "Lorraine",    "2000": 0, "2001": 0, "2002": 0, "2003": 0, "2004": 0, "2005": 81, "2006": 178, "2007": 329, "2008": 386, "2009": 499, "2010": 567, "2011": 637, "2012": 701, "2013": 719, "2014":729, "2015":729, "code_reg": 41 },
	{ "nom_reg": "Midi-Pyrénées",   "2000": 0, "2001": 0, "2002": 23, "2003": 23, "2004": 23, "2005": 25, "2006": 26, "2007": 107, "2008": 264, "2009": 313, "2010": 323, "2011": 384, "2012": 384, "2013": 401, "2014":403, "2015":403, "code_reg": 73 },
	{ "nom_reg": "Nord-Pas-de-Calais",  "2000": 5, "2001": 6, "2002": 9, "2003": 30, "2004": 58, "2005": 62, "2006": 71, "2007": 173, "2008": 215, "2009": 316, "2010": 355, "2011": 400, "2012": 480, "2013": 530, "2014":654, "2015":666, "code_reg": 31 },
	{ "nom_reg": "Pays de Loire",   "2000": 0, "2001": 0, "2002": 0, "2003": 20, "2004": 20, "2005": 24, "2006": 71, "2007": 134, "2008": 180, "2009": 273, "2010": 388, "2011": 416, "2012": 482, "2013": 547, "2014":578, "2015":586, "code_reg": 52 },
	{ "nom_reg": "Picardie",    "2000": 0, "2001": 0, "2002": 0, "2003": 4, "2004": 27, "2005": 82, "2006": 186, "2007": 275, "2008": 453, "2009": 673, "2010": 783, "2011": 875, "2012": 1005, "2013": 1143, "2014":1318, "2015":1430, "code_reg": 22 },
	{ "nom_reg": "Poitou-Charente", "2000": 0, "2001": 0, "2002": 0, "2003": 0, "2004": 9, "2005": 9, "2006": 9, "2007": 21, "2008": 90, "2009": 110, "2010": 173, "2011": 277, "2012": 324, "2013": 326, "2014":438, "2015":448, "code_reg": 54 },
	{ "nom_reg": "Provence-Alpes-Côte-d'Azur",  "2000": 0, "2001": 0, "2002": 1, "2003": 1, "2004": 1, "2005": 22, "2006": 32, "2007": 40, "2008": 45, "2009": 45, "2010": 45, "2011": 45, "2012": 45, "2013": 45, "2014":47, "2015":47, "code_reg": 93 },
	{ "nom_reg": "Rhône-Alpes", "2000": 3, "2001": 3, "2002": 3, "2003": 4, "2004": 28, "2005": 78, "2006": 92, "2007": 112, "2008": 125, "2009": 143, "2010": 147, "2011": 169, "2012": 169, "2013": 169, "2014":169,  "2015":169, "code_reg": 82 }
];
var yearRange = [2000, 2015];
// Fin des données à mettre à jour

var topo_regions = {"type":"Topology","transform":{"scale":[0.013382728838427537,0.008764664816485659],"translate":[-5.139025781735873,42.33348746492439]},
"objects":{"regions_geofla":{"type":"GeometryCollection","geometries":[{"type":"MultiPolygon","id":"43","arcs":[[[1,2,3,4,5,6,7]]],"properties":{"region":"Franche-Comté"}},
{"type":"MultiPolygon","id":"52","arcs":[[[8]],[[9]],[[10,11,12,13,14]]],"properties":{"region":"Pays-de-la-Loire"}},{"type":"MultiPolygon","id":"53","arcs":[[[16]],[[19]],[[21]],[[27,-11,28]]],
"properties":{"region":"Bretagne"}},{"type":"MultiPolygon","id":"82","arcs":[[[29,30,31,-8,32,33],[34]]],"properties":{"region":"Rhône-Alpes"}},{"type":"MultiPolygon",
"id":"11","arcs":[[[35,36,37,38,39]]],"properties":{"region":"Île-de-France"}},{"type":"MultiPolygon","id":"21","arcs":[[[-4,40,-38,41,42,43]]],"properties":{"region":"Champagne-Ardenne"}},
{"type":"MultiPolygon","id":"22","arcs":[[[44,45,46,47,48,-42,-37]]],"properties":{"region":"Picardie"}},{"type":"MultiPolygon","id":"23","arcs":[[[-36,49,50,51,-45]]],
"properties":{"region":"Haute-Normandie"}},{"type":"MultiPolygon","id":"24","arcs":[[[52,-13,53,-50,-40,54,55,56]]],"properties":{"region":"Centre"}},{"type":"MultiPolygon",
"id":"25","arcs":[[[-54,-12,-28,57,-51]]],"properties":{"region":"Basse-Normandie"}},{"type":"MultiPolygon","id":"26","arcs":[[[-32,59,-55,-39,-41,-3,-2],[0]]],
"properties":{"region":"Bourgogne"}},{"type":"MultiPolygon","id":"31","arcs":[[[60,61]]],"properties":{"region":"Nord-Pas-de-Calais"}},{"type":"MultiPolygon",
"id":"41","arcs":[[[-5,-44,62,63]]],"properties":{"region":"Lorraine"}},{"type":"MultiPolygon","id":"42","arcs":[[[-6,-64,64]]],"properties":{"region":"Alsace"}},
{"type":"MultiPolygon","id":"54","arcs":[[[65,66,-14,-53,67]],[[68]],[[70]]],"properties":{"region":"Poitou-Charentes"}},{"type":"MultiPolygon","id":"72","arcs":[[[71,72,-66,73,74,75],[76],[77]]],
"properties":{"region":"Aquitaine"}},{"type":"MultiPolygon","id":"73","arcs":[[[-75,80,81,82,83]],[[-77]],[[-78]]],"properties":{"region":"Midi-Pyrénées"}},{"type":"MultiPolygon",
"id":"74","arcs":[[[-81,-74,-68,-57,84]]],"properties":{"region":"Limousin"}},{"type":"MultiPolygon","id":"83","arcs":[[[-56,-60,-31,85,-82,-85]]],"properties":{"region":"Auvergne"}},
{"type":"MultiPolygon","id":"91","arcs":[[[-83,-86,-30,86,87],[88]]],"properties":{"region":"Languedoc-Roussillon"}},{"type":"MultiPolygon","id":"93","arcs":[[[89]],[[-35]],[[-87,-34,93],[94]]],
"properties":{"region":"Provence-Alpes-Côte-d'Azur"}}]}},
"arcs":[[[790,514],[0,0]],[[781,468],[1,2],[7,2],[0,2],[-4,2],[0,8],[3,0],[3,6],[-4,6],[-2,6],[2,4],[-5,2],[1,4],[9,0],[-1,4]],[[791,516],[-3,4],[-6,0],[-1,4],
[-4,0],[1,10],[4,6],[4,0],[4,8],[3,8],[1,8],[2,4],[-1,8],[-5,0],[-1,8],[-3,0],[1,4],[5,2],[3,5],[-2,7],[-4,3],[-3,-5]],[[786,600],[2,9],[9,0],[3,4],[2,-4],[8,2],
[-3,8],[2,6],[4,0],[0,4],[6,0],[2,6],[3,2]],[[824,637],[1,6],[4,0],[-2,-4],[6,2],[4,6],[7,0],[4,-8],[5,2],[8,0],[4,-2],[3,-6],[5,2],[4,4],[5,-6],[14,-8]],[[896,625],
[0,-4],[5,0],[9,-6],[0,-8],[-2,-2],[0,-5],[5,0],[4,-10]],[[917,590],[-4,-2],[-7,0],[1,-4],[-5,-2],[0,-3],[-4,-7],[10,3],[3,-4],[-3,-1],[-1,-4],[-5,0],[0,-8],[-6,-6],
[-2,-4],[-5,-2],[-5,-6],[2,-2],[-5,-4],[-1,-2],[-11,-4],[-4,-4],[2,-10],[-2,-6],[2,0],[-9,-10],[-3,0],[-14,-14],[3,-4],[-3,-4],[-4,-10]],[[837,466],[-6,-6],
[-6,-10],[-4,-2],[-9,0],[-1,4],[-8,4],[-1,-4],[-4,-3],[-5,0],[0,5],[-3,0],[-9,10],[0,4]],[[207,496],[-3,2],[2,4],[5,-2],[2,-4],[-6,0]],[[223,520],[-3,6],[-5,2],
[-3,2],[3,6],[3,-2],[-1,-4],[6,-4],[0,-6]],[[200,584],[3,3],[4,-3],[4,0],[1,7],[4,-3],[11,4],[1,15],[6,0],[3,4],[7,2],[12,-2],[6,4],[0,4],[12,4],[-1,4],[7,0],
[2,-4],[9,-2],[3,12],[3,4],[0,4],[3,4],[8,0],[-1,8],[-4,14],[-1,10],[4,6],[-3,10],[1,12]],[[304,705],[5,-4],[3,4],[4,-2],[4,0],[3,-6],[3,2],[1,-4],[2,4],[6,2],
[0,-4],[3,2],[5,0],[3,4],[6,2],[6,-4],[2,4],[4,-2],[2,8],[4,-2],[3,-4],[-2,-2],[2,-6],[7,0],[0,-8],[4,2],[5,-2],[3,6],[11,6],[5,0],[3,-4],[1,-8],[2,-6],[8,-4],
[0,-2],[5,-4],[4,0],[2,4],[6,-10],[5,2]],[[444,669],[3,-4],[5,-2],[-4,-2],[-1,-6],[-3,-4],[3,-2],[-2,-4],[2,-6],[-2,-6],[-4,2],[1,-8],[-6,-6],[1,-2],[-7,-2],
[-3,-4],[3,-4],[-5,-2],[-7,-2],[-3,-2],[-1,2],[-3,-2],[3,-5],[-13,4],[-2,-10],[2,0],[-3,-8],[-2,-10],[-6,-10],[0,-6],[-2,-8]],[[388,550],[-3,2],[-4,-6],[0,-4],
[-4,2],[-1,-4],[-5,0],[2,2],[-11,2],[-3,-2],[-4,0],[-7,-4],[1,4],[-8,-4],[2,-2],[-5,-4],[-4,0],[-2,-2],[-7,2],[-5,-4],[2,-4],[0,-6],[4,-4],[6,-4],[-3,-6],[5,-4],
[4,-12],[-1,-10],[1,-10],[-3,-2],[9,-4],[-9,-8],[-7,-2],[-4,4],[-7,-2],[-5,0],[3,6],[-4,-2],[-3,0],[-8,-4]],[[300,454],[-5,0],[-2,-4],[-6,4],[-9,4],[-4,0],[-2,6],
[-9,0],[-14,10],[-5,16],[-8,10],[-12,10],[-1,10],[3,0],[5,8],[1,6],[4,2],[-5,6],[-15,6],[6,2],[1,6],[-2,2],[1,4],[12,2],[0,4],[-10,-1],[-12,-9],[-8,6],[-3,-2],
[-7,4],[3,2],[-4,7],[6,5],[2,0],[-1,4]],[[169,570],[0,0]],[[153,564],[-7,3],[-3,-1],[-3,6],[2,4],[6,-2],[1,-4],[6,-2],[-2,-4]],[[164,575],[0,0]],[[174,598],[0,0]],
[[125,603],[-5,2],[8,0],[-3,-2]],[[170,596],[0,0]],[[1,695],[-1,2],[3,4],[4,-2],[-6,-4]],[[13,691],[0,0]],[[81,731],[0,0]],[[116,737],[0,0]],[[159,742],[0,0]],
[[22,649],[0,0]],[[267,718],[2,-3],[0,-6],[3,-6],[9,-4],[6,4],[3,6],[7,-4],[7,0]],[[200,584],[-3,4],[4,0],[-7,4],[-6,-2],[-3,2],[-1,-4],[-11,0],[-3,4],[-4,2],
[14,0],[1,6],[-4,3],[-7,0],[-3,-5],[-3,2],[0,-4],[-2,0],[-2,4],[-7,-4],[-3,4],[0,-9],[3,-5],[-4,2],[-1,14],[-11,11],[-4,0],[6,8],[-6,-4],[-2,-6],[-5,0],[-6,8],
[-12,2],[-3,2],[-9,0],[-4,8],[-6,4],[0,-6],[-5,0],[-4,2],[-5,-2],[-1,-6],[-14,0],[1,8],[-3,8],[-4,6],[-6,2],[-5,0],[-3,2],[-6,2],[0,2],[8,0],[6,4],[12,2],[6,-2],
[2,6],[-5,6],[-3,0],[-6,4],[-3,-2],[-3,-6],[-2,6],[0,4],[-4,0],[4,4],[-1,4],[3,0],[-2,-4],[9,0],[5,-2],[9,2],[-1,4],[-5,0],[-2,4],[-7,-4],[1,4],[8,6],[-6,-2],
[-11,-4],[-6,-2],[-4,2],[-2,-4],[-4,0],[1,6],[-3,4],[3,6],[-1,2],[1,8],[5,2],[6,0],[6,8],[3,-2],[10,6],[5,-1],[-3,-3],[9,3],[6,4],[6,-3],[0,4],[6,2],[0,-6],[3,0],
[6,-5],[-1,5],[4,4],[6,0],[2,-2],[6,0],[4,-2],[-1,6],[3,1],[-3,5],[4,3],[0,3],[4,1],[3,-4],[10,4],[6,3],[2,-4],[9,6],[-1,-8],[6,0],[0,-5],[5,-1],[0,-4],[5,-6],
[4,-2],[0,-7],[8,-5],[0,-4],[3,-2],[0,4],[3,-2],[7,10],[7,6],[2,-3],[8,7],[2,-3],[-4,-5],[7,2],[3,-6],[3,-2],[1,7],[3,1],[6,-1],[0,-3],[4,-12],[2,2],[-5,12],
[0,4],[7,5],[6,1],[1,-4],[-3,-4],[2,-2],[6,-2],[15,3]],[[731,220],[-6,4],[-4,4],[-4,0],[-1,-6],[-4,2],[0,4],[-5,0],[-5,-8],[-9,6],[-1,2],[-5,-2],[1,10],[-2,4],
[-3,2],[-4,14],[-2,-2],[-4,14],[0,6]],[[673,274],[4,4],[2,6],[6,1],[1,5],[9,0],[4,6],[1,5],[6,0],[-1,6],[6,0],[-2,4],[1,4],[6,2],[0,6],[3,4],[0,4],[-4,4],[-4,-2],
[-3,8],[2,2],[-2,2],[-5,0],[-3,4],[-5,0],[0,-4],[-4,0],[-3,-2],[-2,2],[-3,-4],[-1,4],[-5,2],[-1,-6],[-1,10],[6,4],[1,4],[-2,2],[-1,8],[-10,8],[-4,6],[2,2],[-8,8],
[3,10],[3,2],[-3,4],[-3,0],[2,6],[6,0],[3,2],[-2,6],[1,6],[-2,2],[-2,14],[10,5]],[[675,450],[1,-9],[4,0],[2,-4],[9,4],[2,-4],[9,3],[0,-4],[5,1],[5,6],[1,9],[10,-3],
[6,0],[2,3],[4,0],[0,-5],[3,-2],[-2,-6],[5,-2],[4,12],[6,23],[3,4],[9,-2],[10,2],[2,-6],[6,-2]],[[837,466],[8,-6],[-5,-10],[1,-5],[-8,0],[-3,-4],[0,-5],[6,-3],
[0,3],[6,-3],[4,6],[7,4],[2,2],[-3,2],[0,9],[5,4],[2,-2],[9,2],[3,4],[2,-2],[7,2],[6,0],[7,-2],[-3,-4],[0,-2],[6,-6],[-4,-9],[-2,-5],[3,-3],[6,-1],[0,-9],[3,2],
[6,-10],[2,-6],[-3,-6],[-11,-4],[-2,0],[-2,-2],[1,-10],[3,-4],[4,-2],[2,-4],[5,0],[-2,-6],[2,-2],[0,-8],[4,0],[0,-4],[4,0],[1,-4],[5,-2],[-2,-6],[-4,-4],[2,-8],
[-4,-4],[-6,0],[-5,-6],[-3,0],[-3,-4],[-4,2],[-4,-2],[-4,2],[-1,-4],[-5,0]],[[878,317],[-10,-2],[1,-4],[-3,-2],[-6,2],[-3,6],[-7,0],[1,-6],[-2,0],[-1,-6],[8,0],
[1,-7],[2,0],[0,-12],[-4,4],[-4,-4],[-6,0],[-3,3],[-5,-7],[-2,4],[-6,-4],[2,-4],[-7,-4],[-5,0],[-1,-4],[1,-2],[-2,-4],[-5,-2],[-7,2],[1,-4],[-4,-8],[3,-2],[2,-4],
[-3,0],[-2,-4],[-10,4],[1,-8],[-3,2],[0,-8],[8,-4],[7,0],[-2,-4],[4,-4],[2,-4],[-4,-10],[0,4],[-4,2],[0,-4],[-6,-6],[-4,2],[-2,4],[-3,0],[0,6],[-3,-2],[-7,4],
[-1,-2],[-4,0],[-2,10],[-3,-2],[-4,2],[-3,-2],[-11,-2],[-4,-4],[-2,8],[-2,2],[-8,2],[-1,-8]],[[756,224],[3,2],[0,4],[4,4],[-7,4],[-4,-2],[-4,-12],[8,0]],[[496,754],
[1,4],[-5,8],[13,4],[3,4],[1,10],[2,2]],[[511,786],[3,-2],[0,-4],[3,2],[8,-4],[15,6],[5,-4],[5,0],[0,-2],[5,0],[2,4],[12,-8],[1,-2],[8,-2],[3,2],[4,-4],[7,0],
[2,4],[3,-4],[11,2],[4,0],[2,2],[7,0],[1,-6],[-2,-4],[7,-4],[1,-6],[3,2],[2,-4],[3,2],[1,-6],[7,-3]],[[644,743],[1,-4],[-6,0],[2,-4],[-3,-2],[5,-2],[-1,-12],
[6,0],[2,-2],[-7,-6],[1,-4],[-6,0],[2,-4],[-2,-4],[1,-8]],[[639,691],[-3,0],[-2,-2],[-6,0],[-12,-2],[-4,0],[-3,-6],[3,-6],[-3,-6],[-3,0],[-3,-4]],[[603,665],
[-3,0],[-5,-4],[-2,4],[-7,-4],[-12,2],[-7,-2],[2,4],[3,0],[-1,8],[-5,2],[-1,6],[-8,2],[-4,-2],[-4,4],[-2,-4],[-5,-2],[-10,0],[-2,2],[2,10],[-4,2],[-1,4],[-5,0],
[-4,4],[0,8],[-6,2],[0,4],[-4,2],[-1,4],[-3,1],[-2,5],[3,3],[-3,4],[1,9],[-7,11]],[[786,600],[-3,2],[-7,-2],[-6,9],[-3,-4],[-7,4],[0,4],[-6,-2],[0,8],[-2,2],
[5,2],[-3,6],[-2,2],[-2,6],[-3,-2],[-2,2],[3,2],[-6,2],[0,6],[-9,0],[-7,2],[-3,-2],[2,-4],[-19,-2],[-1,-4],[-3,0],[-2,6],[-5,-2],[-2,-2],[-7,-2],[-10,2],[0,6],
[-2,-2],[-6,16],[-5,2],[-1,4],[-4,-4],[-2,6],[-5,0],[4,4],[0,4],[-10,14],[-5,-2],[-1,4]],[[644,743],[4,8],[3,0],[7,13],[-6,0],[3,6],[-2,4],[2,4],[7,-2],[2,4],
[-3,0],[-4,4],[1,4],[-2,8],[8,2],[4,4],[3,-2],[0,4],[6,2],[3,-2],[6,-2],[0,16],[3,2],[-1,6],[-3,4],[1,2],[6,0],[0,6],[5,2],[4,8],[-2,0],[1,8],[2,2],[0,6],[-3,0],
[1,6]],[[700,870],[7,0],[2,-1],[7,-1],[6,1],[4,4],[8,1],[1,11],[4,1],[3,6],[6,0],[0,-7],[-2,1],[-2,-12],[-2,-4],[4,-1],[2,-4],[-1,-5],[0,-10],[5,0],[5,2],[3,-4],
[4,0],[3,-6],[3,-2],[8,0],[4,-6],[-1,-4],[3,2],[3,-2]],[[787,830],[-6,-6],[-4,-2],[-3,4],[-4,-2],[-4,4],[0,-4],[-4,-6],[4,-10],[-1,-4],[-5,-6],[2,-6],[-8,-4],
[3,-4],[-4,-2],[4,-8],[1,-10],[2,0],[-1,-12],[-8,-2],[2,-8],[-5,-3],[2,-2],[8,-6],[-1,-14],[3,2],[3,-4],[4,-1],[6,-7],[9,-2],[9,-12],[-3,-4],[1,-6],[4,4],[9,-10],
[1,2],[3,-6],[6,-4],[-3,-2],[-2,-8],[-2,-2],[10,-8],[2,-8],[4,0],[3,-4]],[[511,786],[1,4],[6,-2],[1,4],[-3,2],[1,4],[-5,8],[1,4],[4,4],[0,4],[-3,-2],[-1,10],
[-2,2],[3,12],[-2,-2],[3,12],[-3,6],[0,6],[-7,4],[-3,4],[-9,8],[0,4],[-7,0]],[[486,882],[7,4],[4,11],[4,2],[2,-3],[5,-2],[0,5],[-3,0],[-2,4],[-4,4],[1,8],[6,0]],
[[506,915],[1,0]],[[507,915],[2,-4],[10,4],[7,-6],[5,2],[-2,-4],[10,-4],[1,-5],[3,1],[2,-3],[2,3],[9,0],[3,2],[2,-2],[6,2],[3,-4],[-5,-3],[-3,-4],[0,-4],[4,-1],
[1,5],[8,0],[1,-2],[10,-4],[0,5],[6,-4],[-2,-7],[4,4],[5,-2],[13,1],[5,-4],[11,1],[2,-2],[5,2],[10,-1],[4,4],[8,-3],[1,3],[4,1],[7,-4],[2,2],[3,-4],[8,4],[-1,-6],
[7,-1],[1,-3],[5,2]],[[694,872],[6,-2]],[[496,754],[-4,-2],[2,-5],[-5,-2],[-4,-6],[1,-4],[-4,-1],[-11,0],[-3,3],[-1,-6],[-4,2],[-2,-3],[-6,-3],[-6,0],[-1,-4],
[-3,0]],[[445,723],[-4,0],[-2,4],[3,4],[-11,10],[0,2],[-16,4],[-3,3],[3,6],[2,6],[-5,2],[0,4],[3,8],[-3,2],[0,6],[-4,4],[4,2],[-1,4],[-3,-2],[-2,18]],[[406,810],
[-13,4],[-4,6],[7,14],[0,4],[3,4],[9,2],[19,14],[7,2],[7,0],[10,2],[5,4],[5,-1],[9,4],[16,13]],[[472,462],[1,4],[-4,6],[1,4],[-5,4],[-5,0],[0,2],[-8,4],[0,14],
[-5,4],[-2,6],[-8,10],[-1,10],[-10,2],[3,-6],[-4,2],[-8,-2],[0,-2],[-6,2],[-5,0],[0,8],[-4,6],[-2,-2],[-3,0],[2,4],[-7,4],[-2,0],[-2,4]],[[444,669],[2,2],[-3,4],
[1,4],[-3,4],[4,2],[5,2],[7,8],[-3,4],[2,6],[-5,6],[-6,4],[0,8]],[[603,665],[7,-4],[1,-4],[6,-8],[1,-6],[-6,-8],[-3,0],[2,-6],[-1,-8],[-7,-2],[-6,0],[0,-6],[6,-4],
[2,-4],[-2,-1],[2,-8],[-3,0],[-5,-2],[6,-12],[-5,-11],[8,-9],[4,-16],[0,-6],[4,-4],[0,-10],[-2,-4],[0,-6],[-1,-8]],[[611,508],[-6,2],[-5,-4],[-3,-6],[-6,0],
[-5,2],[-2,-4],[-8,-4],[2,-4],[-1,-4],[2,-4],[-5,-4],[-10,0],[-8,-6],[-2,-6]],[[554,466],[-9,0],[-5,-2],[-7,4],[-10,0],[-8,2],[0,-6],[-3,-2],[-3,4],[-2,-4],
[-2,4],[-6,0],[-10,-8],[-3,4],[-11,-2],[-3,2]],[[267,718],[7,-1],[7,2],[-2,4],[-3,-2],[-5,4],[-3,5],[-2,9],[0,8],[3,5],[-2,2],[1,8],[-2,-2],[-2,8],[1,8],[-1,8],
[-2,0],[-6,14],[-7,4],[-3,16],[-3,2],[3,6],[-2,8],[-6,4],[0,4],[10,-4],[7,0],[3,-2],[12,-2],[7,6],[12,0],[3,-8],[-6,-10],[7,-10],[4,-4],[-1,-6],[5,-2],[1,4],
[8,2],[6,-2],[3,-2],[9,-2],[18,0],[8,-2],[8,-4],[9,-2],[10,4],[9,6],[5,4],[11,4]],[[271,719]],[[675,450],[4,4],[3,0],[1,16],[-3,4],[-9,0],[0,4],[-7,2],[-1,6],
[-7,12],[-3,8],[0,-6],[-6,-4],[-2,-4],[-3,0],[0,4],[-5,4],[-1,-4],[-4,0],[-2,4],[-7,-4],[-11,8],[-1,4]],[[694,872],[-5,-2],[-1,3],[-7,1],[1,6],[-8,-4],[0,2],
[-12,4],[-4,-1],[-1,-3],[-8,3],[-4,-4],[-10,1],[-5,-2],[-2,2],[-11,-1],[-5,4],[-13,-1],[-5,2],[-4,-4],[2,7],[-6,4],[0,-5],[-10,4],[-1,2],[-8,0],[-1,-5],[-4,1],
[0,4],[3,4],[5,3],[-3,4],[-6,-2],[-2,2],[-3,-2],[-9,0],[-2,-3],[-2,3],[-3,-1],[-1,5],[-10,4],[2,4],[-5,-2],[-7,6],[-12,-2],[-1,2]],[[506,915],[-6,4],[2,8],[0,8],
[4,-2],[-4,6],[-1,18],[3,4],[-2,12],[3,0],[8,8],[18,7],[11,0],[2,4],[3,-1],[13,5],[2,-3],[7,3],[5,3],[2,-10],[5,-6],[-3,-4],[0,-8],[3,-4],[7,0],[0,-4],[6,-6],
[6,-4],[4,6],[8,4],[7,2],[4,-6],[-1,-2],[5,-2],[-1,-4],[3,-8],[0,-8],[7,-4],[8,4],[3,0],[0,-4],[7,0],[4,-4],[0,-14],[3,-4],[3,6],[7,0],[3,-4],[11,4],[4,-6],[5,-4],
[5,0],[-4,-6],[-2,-9],[4,0],[3,-8],[-5,-2],[-2,-4],[1,-4]],[[787,830],[5,-6],[-1,-4],[2,-4],[6,4],[4,-2],[4,6],[6,-2],[2,2],[6,-4],[3,-4],[6,0],[0,-2],[10,-2],
[2,4],[3,2],[8,0],[4,-4],[8,0],[9,-6],[3,-6],[-2,-2],[3,-6],[4,-2],[4,-12],[8,-2],[2,2],[-1,4],[7,2],[0,-2],[8,-2],[-2,-2],[3,-8],[4,6],[2,-4],[11,0],[6,2],[2,4],
[8,0],[0,-4],[5,-6],[6,-4]],[[955,766],[-4,-10],[-4,-4],[-6,4],[-10,-2],[-2,2],[-12,4],[-4,6],[-5,-10],[-2,0],[-1,-9],[9,-4],[-3,0],[2,-6],[5,2],[0,4],[10,-5],
[2,-4],[-5,-9],[5,-3],[-6,-13],[-4,-2],[-6,0],[2,-4],[-3,-16],[7,-6],[-3,-10],[-6,-10],[2,-2],[-5,-6],[0,-4],[-6,-2],[-1,-6],[0,-6],[-2,-2],[2,-4],[-5,-4]],
[[955,766],[9,0],[3,2],[5,-4],[5,2],[2,-2],[7,-2],[3,-4],[10,-2],[-4,-2],[-3,-5],[-2,-8],[-7,-7],[-4,-1],[0,-4],[-6,-7],[-3,-3],[-3,-5],[0,-9],[-3,-4],[-3,-10],
[2,-8],[-4,-2],[-2,-10],[-7,-10],[0,-12],[4,-6],[-4,-6],[1,-2],[-4,-12],[1,-8],[-3,-4],[1,-4],[4,-3],[1,-6],[-7,-6],[3,0],[-2,-4],[-8,-6],[-6,1],[-6,-3],[-1,3],
[-4,0],[2,5],[-5,2]],[[431,385],[-2,-4],[-8,-6],[2,-4],[-1,-4],[-5,-4],[-2,-4],[-3,0],[-3,-4],[-6,-4],[0,-8],[0,-6],[-3,0],[-6,-10],[-6,2],[-4,-4],[-3,-10],
[-4,2],[-4,-2],[-8,2],[-2,4],[-3,-2],[-3,4],[-2,-2],[-2,6],[0,8],[-4,2],[-8,0],[-1,4],[-9,0]],[[331,341],[-2,8],[-7,12],[-9,6],[-4,6],[-11,6],[-4,4],[-2,0],
[-1,10],[4,0],[4,4],[-2,4],[5,2],[2,6],[-2,2],[0,6],[3,0],[0,6],[-2,0],[-3,10],[-3,3],[-5,-1],[2,8],[7,5],[-1,6]],[[472,462],[-11,-4],[-2,-8],[-8,0],[-4,-3],
[0,-3],[-4,-1],[4,-6],[-2,-4],[0,-10],[4,-4],[1,2],[4,-4],[-1,-6],[-5,-2],[-3,2],[1,-6],[-4,-8],[0,-4],[-5,2],[0,-4],[-6,-6]],[[291,395],[-2,10],[-9,8],[-1,10],
[8,-6],[4,0],[1,-8],[3,-4],[0,-6],[-4,-4]],[[296,419],[0,0]],[[285,435],[-11,6],[-5,0],[-2,4],[5,3],[6,-7],[9,-1],[3,-3],[-5,-2]],[[307,264],[1,0]],[[308,264],
[-3,4],[1,2],[-9,8],[-1,-4],[-4,-4],[-1,-10],[-1,4],[3,30],[2,17],[0,8],[2,12],[0,20],[1,8],[4,8],[3,2],[1,-4],[-2,-2],[15,-14],[7,-10],[2,-10],[4,2],[-1,10]],
[[431,385],[2,-2],[7,0],[2,-4],[-2,-4],[5,-6],[4,6],[2,-2],[9,0],[1,-4],[4,-4],[4,0],[2,-2],[-3,-4],[3,0],[5,-6],[4,0],[-3,-2],[6,-6],[-6,-4],[-1,-6],[3,-4],
[-3,-4],[4,-2],[-3,-4],[3,-2],[6,0],[3,-2],[-1,-2],[1,-6],[3,-4]],[[492,305],[-3,-2],[0,-5],[3,-4],[-3,-8],[-3,0],[0,-4],[-6,-2],[3,-4],[-3,-4],[-3,-2],[-1,-2],
[-6,-2],[0,-4],[-4,-4],[0,-4],[-5,0],[-3,-4],[2,-2],[0,-8],[3,-2],[0,-6],[-8,-2],[-2,4],[-3,-2],[1,-4],[-2,-4],[3,0],[3,-4],[-4,-8],[-3,0],[2,-8],[-6,2],[0,-4],
[-4,0],[-1,-6],[-4,-4],[-6,6],[-5,-2],[-4,0],[-3,-4],[-5,-2],[-4,0],[-2,-2],[-5,2],[0,2],[-5,-2],[-5,-2],[-3,-4],[2,-4],[-4,-2],[-3,4],[1,4],[-3,0],[-5,-4],
[-5,0],[-5,-4],[4,-2],[-2,-2],[1,-6],[-2,-2],[2,-6],[-3,-4],[0,-5],[-3,-5],[4,-3],[10,-1],[0,-5],[4,-2],[2,-6],[-4,0],[2,-4],[3,2],[1,-4],[-1,-6],[1,-4],[-3,0],
[-1,-6],[2,0],[-4,-12],[-4,0],[-2,-4],[-4,-4],[1,-6],[-8,-6],[1,-8],[-3,0],[1,-8]],[[361,59],[-6,-6],[-10,2],[-7,-2],[0,4],[-6,6],[-3,0],[0,4],[-1,4],[-5,-2],
[-10,2],[-12,8],[-2,-2],[-5,4],[-4,0],[-4,2],[3,6],[-6,-2],[1,-6],[-2,-2],[-6,2],[-2,4],[5,6],[0,6],[2,0],[0,6],[-9,4],[-5,2],[0,-4],[-4,0],[0,6],[-3,0],[-5,-2],
[-4,6],[2,4],[6,0],[5,6],[6,10],[6,15],[0,4],[3,16],[2,6],[5,28],[3,24],[1,24],[4,8],[1,6],[8,-4],[4,2]],[[375,103],[3,2],[-2,6],[-3,-4],[2,-4]],[[378,111],[1,4],
[-4,-2],[3,-2]],[[308,264],[-1,0]],[[307,264],[1,0]],[[492,305],[7,4],[7,-2],[5,-4],[4,-6],[6,-1],[6,6],[2,-4],[5,4],[4,0]],[[538,302],[3,-8],[-1,-4],[6,-8],
[-1,-10],[-2,-2],[4,-4],[-1,-4],[4,-2],[-1,4],[4,2],[5,0],[2,-4],[8,0],[3,6],[3,2],[1,6],[3,4],[0,4],[6,9],[5,4],[2,-3],[0,-6],[7,2],[-1,-4],[3,-6],[3,0],[0,-10],
[3,-6]],[[606,264],[8,-10],[-2,-6],[6,-6],[1,-4],[-2,-8],[3,-6],[-3,-4],[3,0],[5,-4],[1,-4],[9,0],[1,-2],[-3,-2],[-1,-6],[-4,-2],[2,-2],[3,0],[1,-2],[8,-4],
[-3,-6],[-5,-4],[0,-4],[-5,0],[-3,-2],[1,-6],[-2,-2],[-7,0],[-6,2],[0,-14],[-4,0],[-6,-2],[-2,-3],[-10,-5],[-1,1],[-7,4],[-3,-6],[1,-4],[4,-6],[-1,-6],[-6,-6],
[-5,0],[-1,2],[-10,-2],[-8,4],[-3,-2],[0,-6],[-4,4],[-7,-2],[-3,4],[-3,-2],[-3,2],[-3,-4],[-4,4],[-4,-4],[1,-6],[-7,0],[1,-4],[-4,-4],[3,-8],[-1,-2],[5,-4],[8,0],
[5,-4],[-1,-8],[3,-2],[0,-8],[-4,-2],[4,-2],[0,-6],[-8,-2],[-1,-4],[5,-4],[2,-6],[5,0],[5,2],[0,-2],[6,-4],[0,-4],[-3,2],[-8,-4],[-6,-4],[-3,0],[-1,-2],[-8,-2]],
[[517,27],[-4,2],[1,2],[-10,2],[-2,2],[-7,0],[-1,-4],[-5,2],[-1,6],[-6,4],[-5,2],[-6,-2],[-4,6],[-9,2],[-2,2],[-3,-2],[-3,4],[-8,2],[-3,2],[-6,-2],[1,-4],[-2,-2],
[3,-6],[-1,-4],[-11,0],[-8,0],[-4,4],[-5,-6],[-3,4],[-6,2],[-9,-4],[-8,0],[-8,10],[-6,2],[-5,6]],[[554,466],[1,-4],[4,-2],[-3,-2],[2,-4],[4,2],[7,-6],[3,-5],
[0,-4],[4,-8],[-2,-2],[2,-8],[2,-2],[1,-8],[-3,0],[-1,-6],[-5,-4],[-2,0],[-3,-4],[-3,0],[4,-8],[4,-4],[3,-6],[-1,-4],[-3,0],[0,-8],[3,-2],[0,-8],[-2,-8],[3,-2],
[-4,-4],[-9,6],[1,-6],[-6,-8],[-7,-8],[3,-6],[-4,-4],[-1,-6],[-3,0],[-2,-2],[3,-6],[-6,-3]],[[673,274],[-5,4],[-4,8],[-6,-1],[1,3],[-6,2],[-1,-6],[-3,1],[-4,-3],
[-4,4],[-2,7],[0,5],[-6,0],[-1,-1],[-7,-3],[-1,-4],[-4,0],[-2,3],[-3,-5],[1,-3],[-4,-3],[0,-4],[-6,-14]],[[731,220],[3,-4],[-1,-2],[3,-2],[0,-10],[0,-4],[4,2],
[6,-12],[-15,-16],[1,-6],[-4,-12],[-5,2],[-4,0],[-4,-9],[3,-1],[-1,-3],[-8,-4],[-2,-4],[-6,-2],[-1,-4]],[[700,129],[-5,0],[-3,4],[-1,6],[-8,0],[-12,-8],[-3,-6],
[-10,-4],[-4,-4],[-8,-10],[-8,2],[-10,-6],[-8,-12],[-1,0],[-5,-10],[-3,-10],[1,-4],[-1,-10],[0,-28],[1,-6],[6,-2],[0,-4],[3,-6],[-7,0],[-3,4],[-5,0],[-2,2],
[-2,-4],[-6,0],[-5,-4],[-4,0],[-5,-4],[2,-4],[-5,0],[-4,2],[-2,-3],[-4,1],[-3,6],[-7,0],[-6,4],[-10,-2],[-1,-4],[-8,-4],[-3,4],[-2,8],[-4,0],[-6,4],[-6,0],[1,8],
[3,2]],[[532,13],[0,0]],[[865,77],[0,2],[5,2],[-2,-4],[-3,0]],[[847,73],[0,0]],[[862,75],[0,0]],[[910,135],[0,0]],[[878,317],[4,-6],[1,-4],[5,-2],[1,-8],[-1,-4],
[4,-1],[3,-4],[7,0],[5,-2],[1,-4],[-1,-2],[1,-2],[0,-6],[5,-4],[-7,0],[-4,-4],[0,-8],[-6,-6],[0,-4],[6,-8],[-3,0],[0,-8],[8,-8],[1,-6],[5,0],[1,-2],[8,-2],[6,-6],
[5,0],[1,-4],[15,4],[4,0],[1,4],[4,0],[-1,-6],[4,-4],[-4,-8],[-2,-4],[-5,-4],[-1,-6],[-5,-2],[3,-12],[-4,-2],[-2,0],[-4,-4],[-4,0],[-4,-4],[-3,0],[-2,-3],[-5,0],
[-3,-10],[-6,-4],[-3,2],[-5,-4],[2,-2],[-5,-8],[-12,-2],[-1,-8],[-10,-8],[0,-2],[6,0],[1,-6],[-5,-4],[-4,2],[-5,-4],[-9,-2],[0,-6],[-6,2],[-1,2],[-6,0],[-3,-4],
[0,-6],[-3,6],[-7,0],[-3,2],[-4,0],[-2,2],[-4,-8],[-4,2],[1,6],[-6,2],[-6,6],[-3,-2],[-4,2],[0,2],[-16,0],[2,4],[0,6],[-4,8],[-6,-4],[-12,0],[-4,2],[-3,8],[-5,2],
[-3,-2],[-3,0],[0,-2],[3,-4],[-1,-4],[-6,2],[-13,0],[-3,2],[2,8],[-5,2],[-7,0],[-15,2]],[[762,121],[6,0],[7,6],[-1,4],[-5,-4],[-3,8],[-7,0],[-1,-6],[4,0],[0,-8]]]
};

var width = 960,
    height = 850;
    
var svg = d3.select("body").append("svg")
    .attr('width', width)
    .attr('height', height);
var regions = svg.append("g")
    .attr("id", "regions")
    .selectAll("path"),
    topo_regions;
    
var proj = d3.geo.conicEqualArea()
        .center([2.5,47])
        .parallels([43, 49])
        .scale(3600)
        .translate([width/2-130, height/2-130]);
var path = d3.geo.path()
    .projection(proj);
    
var dataById = {},
    colorScale,
    timeout,
    animationOn = false;

var carto = d3.cartogram()
    .projection(proj)
    .properties(function(d) { 
        return dataById[d.id];
    })
    .value(function(d) { 
        return d.properties[field];
    });
    
var tooltip = d3.select("body")
	.append("div")
    .attr("class", "tooltip")
	.style("visibility", "hidden");
    
// Bouton de déclanchement de l'animation
var button = svg.append("g")
    .attr("id", "play_anim")
    .attr("transform", "translate(10,50)")
    .on("click", function() {
        if (!animationOn) {
            animationOn = true;
            d3.select("#play_anim text").html("&#x25A0; Arrêter");
            update(annees[0]);
        } else {
            stopAnim();
        }
    });
button.append("rect")
    .attr("width", 120)
    .attr("height", 40)
    .attr("x", 0).attr("y", 0)
    .attr("ry", 10);
button.append("text")
    .html("&#x25B6; Animation")
    .attr("x", 60).attr("y", 25);

    
  
function update(field) {
    if (!(field in regions.data()[0].properties)) {
        stopAnim();
        return false;
    }
    currentYear = parseInt(field);

    var value = function(d) { return +d.properties[field] },
        values = regions.data()
            .map(value)
            .filter(function(n) { return !isNaN(n); })
            .sort(d3.ascending),
        mini = values[0],
        maxi = values[values.length -1],
        scale = d3.scale.linear()
            .domain([mini, maxi])
            .range([.1, 10]);
            
    carto.value(function(d) {
        return scale(value(d));
    });
    
    var total = d3.sum(values);
    d3.select("#legende").text(field + " : " + total + " MW raccordés");
    
    var features = carto(topo_regions, topo_regions.objects.regions_geofla.geometries).features;
    
    regions.data(features)
        .on("mouseover", function(d){return tooltip.style("visibility", "visible")
            .html(d.properties.nom_reg + "<br />" + d.properties[field] + " MW");})
        .on("mousemove", function(){return tooltip
            .style("top", (d3.event.pageY-10)+"px").style("left",(d3.event.pageX+20)+"px");})
        .on("mouseout", function(){return tooltip.style("visibility", "hidden");});

    regions.transition()
        .duration(750)
        .ease("linear")
        .attr('d', carto.path)
        .attr('fill', function(d) {
            return colorScale(value(d));
        });
        
    perYear.forEach(function(k, v) {
        v.selected = (k == field);
    });
    svg.selectAll("rect.graphBar")
        .data(perYear.entries())
        .classed("selected", function(d) { return d.value.selected; });
        
    // Animation
    if (animationOn) {
        timeout = setTimeout(function() {
            update(parseInt(field)+1);
        }, 1000);
    }
}

function makeGraph() {
    var graphHeight = 110;
    annees.forEach(function(k) {
        perYear.set(k, {power:0, selected:false});
    });
    data.forEach(function(li) {
        annees.forEach(function(a) {
            perYear.set(a, {power: perYear.get(a).power + li[a], selected: false});
            if (li[a] > maxi) maxi = li[a];
            if (li[a] < mini) mini = li[a];
        });
    });
    
    var barWidth = 35;
    var scale = d3.scale.linear()
    .domain([annees[0], annees[annees.length-1]])
    .range([0, annees.length * barWidth]);
    
    // axe
    var axis = d3.svg.axis()
        .scale(scale)
        .tickValues(annees)
        .tickFormat(d3.format(""));
    var graph = svg.append("g")
        .attr("id", "annees")
        .attr("transform", "translate(" + 80 + ", " + (650 + graphHeight) + ")")
        .data(annees)
        .call(axis);
        
    d3.selectAll(".tick.major").on('click', function(d) {
        update(d);
    });

    // barres
    var power = function(d) { return d.power; };
    var barSizeScale = d3.scale.linear()
        .domain([0, d3.max(perYear.values(), power)])
        .range([0, graphHeight]);
    var rects = graph.append("g")
        .attr("id", "bars")
        .selectAll("rect")
        .data(perYear.entries())
        .enter().append("rect")
            .attr("class", "graphBar")
            .attr("x", function(d, i) { return scale(d.key) - barWidth/2; })
            .attr("y", function(d) { return  -barSizeScale(d.value.power); })
            .attr("width", barWidth)
            .attr("height", function(d) { return barSizeScale(d.value.power); })
            .on('click', function(d) { update(d.key); });
            
    // boutons de controle d'avancement
    var coords = "M 100,50 L 0,0 L 30,50 L 0,100";
    graph.append("path")
        .attr("class", 'controlButton')
        .attr('d', coords)
        .attr("transform", "translate(-30 " + (-graphHeight/2) + ") scale(-.2 .2)")
        .on("click", function() {
            var nyear = currentYear - 1;
            if (nyear < annees[0]) nyear = annees[0];
            update(nyear);
        });
    graph.append("path")
        .attr("class", 'controlButton')
        .attr('d', coords)
        .attr("transform", "translate(" + (scale.range()[1]+50) + " " + (-graphHeight/2) + ") scale(.2)")
        .on("click", function() {
            var nyear = currentYear + 1;
            if (nyear > annees[annees.length-1]) nyear = annees[annees.length-1];
            update(nyear);
        });
        
    graph.append("text")
        .attr("id", "legende")
        .attr("x", 50).attr("y", -130)
}           
    
function visualScale() {
    svg.append("linearGradient")
        .attr("id", "gradientScale")
        .attr("x1", "0%").attr("y1", "0%")
        .attr("x2", "0%").attr("y2", "100%")
    .selectAll("stop")
        .data([{offset: "0%", color: colorScale.range()[1]},
            {offset: "100%", color: colorScale.range()[0]}])
        .enter().append("stop")
            .attr("offset", function(d) { return d.offset; })
            .attr("stop-color", function(d) { return d.color; });
    var legendeGroup = svg.append("g").attr("id", "legende_couleurs")
        .attr("transform", "translate(50," + (height-300) + ")");
    legendeGroup.selectAll("text")
        .data([mini, maxi])
        .enter().append("text")
            .attr("x", 12).attr("y", function(d, i) { return (1-i) * 100; })
            .text(function (d) { return d + " MW"; });
    legendeGroup.append("rect")
        .attr("width", 10).attr("height", 100)
        .style("fill", "url(#gradientScale)");
}

dataById = d3.nest()
    .key(function(d) { return d.code_reg; })
    .rollup(function(d) { return d[0]; })
    .map(data);
    
var annees = d3.range(yearRange[0], yearRange[1]+1),
    perYear = d3.map(),
    mini = Infinity, maxi=0,
    currentYear;

makeGraph();

var colorScale = d3.scale.linear()
    .domain([mini,maxi])
    .range(["#FFFFCC", "#005A32"]);

// Echelle visuelle
visualScale();

currentYear = annees[0];

var features = carto.features(topo_regions, topo_regions.objects.regions_geofla.geometries);
regions = regions.data(features)
    .enter()
    .append("path")
        .attr("class", "region")
        .attr("id", function(d) {
            return d.properties.code_reg;
        })
        .attr("d", path);
        
update(annees[0]);

function stopAnim() {
    clearTimeout(timeout);
    animationOn = false;
    d3.select("#play_anim text").html("&#x25B6; Animation");
}
</script>

<div id="commentaire">
<p><b>Cartogramme dynamique de la puissance d'énergie éolienne installée par région en France</b></p>
<p>Pour une année donnée, la surface représentée d'une région est proportionnelle à la puissance installée par rapport à la puissance nationale.
(Les régions ayant une puissance nulle sont quand même affichées) Le gradient de couleurs représente la valeur absolue de la puissance installée pour chaque région.</p>
<p>Cliquer sur le graphe (le chiffre ou la barre) pour afficher le cartogramme à une année donnée.
Cliquer sur les flèches de chaque côté du graphe pour avancer/reculer d'une année.</p>
<p><small>Sources des données : RTE, SOES.<br />Conception : A. Roche pour Nordex France.</small></p>
</div>
</body>
</html>
